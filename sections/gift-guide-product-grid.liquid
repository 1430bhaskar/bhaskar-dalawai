{% comment %}
  Gift Guide — Product Grid Section (from scratch)
  - Displays exactly six selectable products
  - Clicking a tile opens custom modal with:
      title, price (variant-aware), short description, dynamic option pickers,
      and functional Add to Cart (AJAX).
  - Special rule: if selected options include Color=Black and Size=Medium,
    automatically add the "Soft Winter Jacket" (upsell product) as well.
  - Vanilla JS only (gift-guide.js). No Dawn components.
{% endcomment %}

{{ 'gift-guide.css' | asset_url | stylesheet_tag }}
<script src="{{ 'gift-guide.js' | asset_url }}" defer="defer"></script>

<section
  id="gift-guide-grid-{{ section.id }}"
  class="gift-guide-grid-section"
  data-money-format="{{ shop.money_format | escape }}"
  data-upsell-handle="{{ all_products[section.settings.upsell_product].handle | default: 'soft-winter-jacket' }}"
  aria-label="Gift Guide product grid"
>
  {% if section.settings.grid_heading != blank %}
    <h2 class="gg-grid__heading">{{ section.settings.grid_heading }}</h2>
  {% endif %}

  <div id="gift-guide-grid-anchor" class="gg-grid">
    {% for i in (1..6) %}
      {% assign picker = 'product_' | append: i %}
      {% if section.settings[picker] != blank %}
        {% assign prod = all_products[section.settings[picker]] %}
        {% if prod %}
          <article class="gg-card" data-handle="{{ prod.handle }}" tabindex="0" role="button" aria-label="{{ prod.title }}">
            <div class="gg-card__image">
              <img
                src="{{ prod.featured_image | img_url: '800x' }}"
                alt="{{ prod.featured_image.alt | default: prod.title | escape }}">
              <span class="gg-card__plus" aria-hidden="true">+</span>
            </div>
            <div class="gg-card__meta">
              <span class="gg-card__title">{{ prod.title }}</span>
              <span class="gg-card__price">{{ prod.price | money }}</span>
            </div>
          </article>
        {% else %}
          <div class="gg-card gg-card--empty">Product {{ i }} not found</div>
        {% endif %}
      {% else %}
        <div class="gg-card gg-card--placeholder">Select product {{ i }}</div>
      {% endif %}
    {% endfor %}
  </div>

  <!-- Accessible Modal -->
  <div id="gg-modal" class="gg-modal gg-is-hidden" aria-hidden="true" role="dialog" aria-modal="true" aria-label="Quick add">
    <div class="gg-modal__dialog" role="document">
      <button class="gg-modal__close" type="button" aria-label="Close">×</button>
      <div class="gg-modal__body"><!-- injected by JS --></div>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Gift Guide — Product Grid",
  "settings": [
    { "type": "text", "id": "grid_heading", "label": "Grid heading", "default": "Tisso vison in the wild" },

    { "type": "product", "id": "product_1", "label": "Product 1" },
    { "type": "product", "id": "product_2", "label": "Product 2" },
    { "type": "product", "id": "product_3", "label": "Product 3" },
    { "type": "product", "id": "product_4", "label": "Product 4" },
    { "type": "product", "id": "product_5", "label": "Product 5" },
    { "type": "product", "id": "product_6", "label": "Product 6" },

    { "type": "product", "id": "upsell_product", "label": "Upsell product (Soft Winter Jacket)" }
  ],
  "presets": [
    { "name": "Gift Guide — Product Grid" }
  ]
}
{% endschema %}
